#pragma once

#include<time.h>
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<SDL2/SDL.h>

typedef unsigned char byte;
typedef unsigned short word;

struct CHIP8 {
  byte DT,ST,SP,MEM[4096],SCR[32][8],V[16];
  word I,PC,KB,STK[16];
};

byte MAP[256]={
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  3,0,0, 0,0,0, 0, 0,1,2, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 5,0,0, 0, 4,6,0, 0,0,7,12,10,0,
  0,0,8,11,9,0,14,13,0,0,15,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0,
  0,0,0, 0,0,0, 0, 0,0,0, 0,0,0, 0, 0,0
};

byte charset[5*16]={
  0xf0,0x90,0x90,0x90,0xf0,  0x20,0x60,0x20,0x20,0x70,  0xf0,0x10,0xf0,0x80,0xf0,  0xf0,0x10,0xf0,0x10,0xf0,
  0x90,0x90,0xf0,0x10,0x10,  0xf0,0x80,0xf0,0x10,0xf0,  0xf0,0x80,0xf0,0x90,0xf0,  0xf0,0x10,0x20,0x40,0x40,
  0xf0,0x90,0xf0,0x90,0xf0,  0xf0,0x90,0xf0,0x10,0xf0,  0xf0,0x90,0xf0,0x90,0x90,  0xe0,0x90,0xe0,0x90,0xe0,
  0xf0,0x80,0x80,0x80,0xf0,  0xe0,0x90,0x90,0x90,0xe0,  0xf0,0x80,0xf0,0x80,0xf0,  0xf0,0x80,0xf0,0x80,0x80
};

typedef void(*inst)(struct CHIP8*,word);

#define F(id,body) void id(struct CHIP8*M,word oc){        \
    byte x=oc>>8&0xf,y=oc>>4&0xf,n=oc&0xf,kk=oc&0xff;	   \
    word nnn=oc&0xfff;					   \
    do{body;}while(0);                                     \
  }
