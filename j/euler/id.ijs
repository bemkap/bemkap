M=: >./@:(foo~/#:@:i.@:(2^#)@:g)"0
foo=: (]|(crt g))"1 0
crt=: +/@:*((in~*])ni)
g=: *//.~@:q:
in=: 4 : 'x y&|@^ <:phi y'"0
ni=: %~*/
phi=: 5&p: