f=: 3 : '+/~.(*/@#~2:#:@:i.@:^#);@:(<@q:)((i.@:>:)!])y'
({. */@:^"1 (#: i.@:(*/))@:>:@:{:)@:(~. ,: #/.~)